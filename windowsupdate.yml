---
# file: windowsupdate.yml
- name: windowsupdate!
  hosts: all
  gather_facts: no
  any_errors_fatal: false
  serial:
     - 1
     - 5%
     - 25%
  max_fail_percentage: 10%
  vars:
    win_updates_categories:
         - CriticalUpdates
         - SecurityUpdates 
  tasks:
  # Check if there are missing updates
  - name: Check for missing updates.
    win_updates:
      state: searched
      category_names: "{{ win_updates_categories }}"
    register: update_count
    ignore_errors: yes
